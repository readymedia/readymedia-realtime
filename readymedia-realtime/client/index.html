<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReadyMedia Realtime - Universell Sanntidsteksting</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body data-theme="dark" data-layout="fullscreen" data-text-flow="scroll">
    
    <!-- Status Bar -->
    <div id="statusBar" class="status-bar">
        <div class="status-indicator">
            <span class="status-dot" id="connectionStatus"></span>
            <span id="statusText">Not connected</span>
        </div>
        <div class="audio-level">
            <div class="level-bar" id="audioLevel"></div>
        </div>
    </div>

    <!-- Control Panel -->
    <div id="controlPanel" class="control-panel">
        <div class="control-header">
            <h1>ğŸ™ï¸ ReadyMedia Realtime</h1>
        </div>

        <div class="control-content">
            <!-- Audio Input -->
            <div class="control-group">
                <label>ğŸ¤ Audio Source</label>
                <div class="control-row" style="gap: 10px; align-items: flex-start;">
                    <select id="audioInput" class="control-select" style="flex: 1; min-width: 0; max-width: calc(100% - 50px);">
                        <option value="">Select microphone...</option>
                    </select>
                    <button id="refreshMics" class="btn-secondary" title="Refresh microphone list" style="flex-shrink: 0;">ğŸ”„</button>
                </div>
                <div class="control-row" style="margin-top: 10px;">
                    <button id="toggleMic" class="btn-secondary btn-start" disabled>â–¶ï¸ Start transcription</button>
                </div>
                <small id="micHelpText" class="help-text" style="display: none; color: #888; font-size: 12px; margin-top: 5px;">
                    No microphones? Click ğŸ”„ to refresh the list.
                </small>
            </div>

            <!-- Font Settings -->
            <div class="control-group">
                <label>ğŸ”¤ Typography</label>
                <div class="control-row">
                    <select id="fontFamily" class="control-select">
                        <option value="'Inter', sans-serif">Inter</option>
                        <option value="'Roboto', sans-serif">Roboto</option>
                        <option value="'Source Sans Pro', sans-serif">Source Sans Pro</option>
                        <option value="'Open Sans', sans-serif">Open Sans</option>
                        <option value="'Noto Sans', sans-serif">Noto Sans</option>
                    </select>
                    <select id="fontSize" class="control-select">
                        <option value="xs">XS (36px)</option>
                        <option value="s">S (44px)</option>
                        <option value="m" selected>M (52px)</option>
                        <option value="l">L (64px)</option>
                        <option value="xl">XL (72px)</option>
                        <option value="xxl">XXL (88px)</option>
                    </select>
                </div>
                <div class="control-row">
                    <label>Line spacing</label>
                    <input type="range" id="lineHeight" min="1.2" max="1.8" step="0.1" value="1.4">
                    <span id="lineHeightValue">1.4</span>
                </div>
            </div>

            <!-- Theme -->
            <div class="control-group control-group-compact">
                <label>ğŸ¨ Theme</label>
                <div class="control-row">
                    <select id="themeSelect" class="control-select">
                        <option value="dark">ğŸŒ™ Dark theme</option>
                        <option value="light">â˜€ï¸ Light theme</option>
                        <option value="chroma">ğŸ¬ Chroma key</option>
                    </select>
                </div>
            </div>

            <!-- Display Mode -->
            <div class="control-group control-group-compact">
                <label>ğŸ“º Viewing Mode</label>
                <div class="control-row">
                    <select id="displayModeSelect" class="control-select">
                        <option value="fullscreen-short">Fullscreen Short</option>
                        <option value="fullscreen-long">Fullscreen Long</option>
                        <option value="captions-lower">Captions Lower</option>
                    </select>
                </div>
            </div>

            <!-- Actions -->
            <div class="control-group control-group-compact">
                <label>âš¡ Actions</label>
                <div class="control-row" style="gap: 10px; flex-wrap: wrap;">
                    <button id="clearText" class="btn-warning">ğŸ—‘ï¸ Clear (C)</button>
                    <button id="downloadTranscripts" class="btn-secondary">ğŸ“„ Transcripts</button>
                    <button id="infoButton" class="btn-secondary">â„¹ï¸ Info</button>
                    <button id="fullscreenToggle" class="btn-primary">â›¶ Fullscreen (F)</button>
                    <button id="clearAllData" class="btn-warning" style="font-size: 12px; padding: 5px 10px;" title="Clear all data (transcripts, API key, settings)">ğŸ—‘ï¸ Clear All Data</button>
                </div>
            </div>

            <!-- Language -->
            <div class="control-group">
                <label>ğŸŒ Language</label>
                <select id="languageSelect" class="control-select">
                    <option value="en">English</option>
                    <option value="no">Norwegian</option>
                    <option value="de">German</option>
                    <option value="fr">French</option>
                    <option value="sv">Swedish</option>
                    <option value="da">Danish</option>
                    <option value="">Auto-detection</option>
                </select>
                <span id="detectedLanguage" style="display: none;">Auto-detection active</span>
            </div>
        </div>
    </div>

    <!-- API Key Modal - Shown on first visit -->
    <div id="apiKeyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ”‘ Enter Your ElevenLabs API Key</h2>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 15px;">To use this application, you need your own ElevenLabs API key. This key is stored locally in your browser and never shared.</p>
                <div style="margin-bottom: 15px;">
                    <label for="apiKeyInput" style="display: block; margin-bottom: 5px; font-weight: 500;">API Key:</label>
                    <input type="password" id="apiKeyInput" class="control-input" placeholder="sk_..." style="width: 100%; padding: 10px; font-family: monospace;">
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button id="saveApiKey" class="btn-primary">Save & Continue</button>
                </div>
                <small style="display: block; margin-top: 10px; color: #888; font-size: 12px;">
                    You can get your API key from <a href="https://elevenlabs.io" target="_blank" style="color: #4a9eff;">elevenlabs.io</a>. You can change it later in the settings.
                </small>
            </div>
        </div>
    </div>

    <!-- Info Modal - Outside main container for proper positioning -->
    <div id="infoModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>â„¹ï¸ Info</h2>
                <button id="closeInfoModal" class="btn-icon" title="Close">âœ•</button>
            </div>
            <div class="modal-body">
                <div id="infoContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Transcripts Modal - For viewing and downloading transcripts -->
    <div id="transcriptsModal" class="modal hidden">
        <div class="modal-content" style="max-width: 800px; max-height: 80vh;">
            <div class="modal-header">
                <h2>ğŸ“„ Transcripts</h2>
                <button id="closeTranscriptsModal" class="btn-icon" title="Close">âœ•</button>
            </div>
            <div class="modal-body" style="overflow-y: auto; max-height: calc(80vh - 120px);">
                <div id="transcriptsList" style="display: flex; flex-direction: column; gap: 10px;">
                    <!-- Transcripts will be populated by JavaScript -->
                </div>
                <div id="noTranscripts" style="text-align: center; padding: 40px; color: #888; display: none;">
                    No transcripts saved yet. Transcripts will appear here after you save them.
                </div>
            </div>
            <div class="modal-footer" style="padding: 15px; border-top: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
                <button id="downloadAllTranscripts" class="btn-secondary" style="display: none;">ğŸ“¥ Download All</button>
                <button id="clearAllTranscripts" class="btn-warning" style="display: none;">ğŸ—‘ï¸ Clear All</button>
            </div>
        </div>
    </div>

    <!-- Text Display Area -->
    <div id="textDisplay" class="text-display">
        <div id="textContainer" class="text-container">
            <!-- Partial transcript (live) -->
            <div id="partialText" class="partial-text"></div>
            <!-- Committed transcripts -->
            <div id="committedTexts" class="committed-texts"></div>
        </div>
    </div>

    <!-- Loading/Error Overlay -->
    <div id="overlay" class="overlay hidden">
        <div class="overlay-content">
            <div class="spinner"></div>
            <p id="overlayMessage">Connecting...</p>
        </div>
    </div>

    <script src="app.js?v=47"></script>
</body>
</html>
